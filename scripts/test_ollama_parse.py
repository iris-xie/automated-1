import json
from .fm_utils import parse_ollama_response


if __name__ == "__main__":
    RAW = """{"model":"deepseek-r1:7b","created_at":"2025-11-23T10:34:46.4008665Z","response":"```json\n{\n  \"title\": \"Guide to Surviving in the City by Renting\",\n  \"description\": \"Essential knowledge for novice tenants on budgeting, location, viewings, and contracts. Learn how to find an ideal accommodation while saving money and avoiding common mistakes.\",\n  \"keywords\": [\n    \"renting tips\",\n    \"saving money\",\n    \"city life\",\n    \"tenancy advice\",\n    \"budget planning\",\n    \"moving services\",\n    \"electric water bills\",\n    \"legislation\",\n    \"contract review\",\n    \"tenant toolkits\",\n    \"home maintenance\",\n    \"moving tips\",\n    \"relocation guide\",\n    \"residential leases\",\n    \"consumer rights\",\n    \"local services\",\n    \"renter discounts\",\n    \"coupons\",\n    \"move preparation\"\n  ],\n  \"categories\": [\"Housing\", \"City Life\", \"Tenancy\"],\n  \"tags\": [\"renting tips\", \"city life\", \"tenancy advice\", \"budget planning\", \"moving services\"]\n}\n```","thinking":"Alright, let me try to figure out how to approach this query. The user provided a block of text and asked for a JSON object with specific fields based on that content. They also mentioned using Google SEO standards and keeping each section within character limits.\n\nFirst, I need to read through the given English content carefully. It's about a guidebook for renting in the city. The main sections include saving money, living during the lease, after the lease, tenant toolkits, and renter giveaways with coupons.\n\nI'll start by extracting the title. The most important part is \"Guide to Surviving in the City by Renting,\" but it's a bit long. Maybe shorten it to fit under 60 characters: \"Guide to Surviving in the City by Renting.\"\n\nNext, the description needs to be concise and follow Google SEO guidelines. It should include main keywords like \"renting tips,\" \"saving money,\" etc., and be natural without quotes or line breaks. I'll make sure it's around 160 characters.\n\nFor keywords, I'll list up to 20 relevant terms. From the text, important ones might include topics like budget planning, moving services, electric water bills, and so on.\n\nCategories should be broader classifications. The guide covers various aspects of renting, so maybe \"Housing,\" \"City Life,\" and \"Tenancy\" fit well.\n\nTags are specific keywords that help with searchability. I'll select 3-8 tags related to the content, like \"renting tips,\" \"city life,\" etc.\n\nI need to ensure all fields meet their respective length constraints: title under 60 characters, description under 160. Keywords up to 20 words, categories and tags each within reasonable numbers.\n\nFinally, I'll structure everything into a JSON object without any additional text or explanations, just the JSON as requested.\n","done":true,"done_reason":"stop","context":[151644,14880,100345,87752,105205,43815,31526,46944,4718,69162,46423,3837,102298,105220,44931,5122,2102,9909,106070,21,15,48391,9370,105205,60396,64359,4684,9909,101137,5085,24980,51461,229,99308,9370,105205,8823,55059,44834,3837,106070,16,21,15,48391,3837,102298,99558,105291,3837,110485,99795,3837,42192,72586,17992,3837,42192,71134,22243,64359,28995,9909,102538,17,15,18947,105205,105291,9370,69824,64359,15497,9909,16,4142,18,18947,99845,100461,70538,9370,69824,64359,14082,9909,18,4142,23,18947,100398,105151,9370,69824,74276,100148,66017,99885,104136,57191,104107,100178,3837,99373,66017,4718,3407,58,35134,311,2213,9533,2428,1110,89,1704,524,22048,370,15918,905,26559,13378,2762,692,12712,311,28778,2249,304,279,4311,553,29737,287,715,43256,271,8784,17633,11,28737,22291,11,34006,34098,2050,271,32,11376,369,264,71545,25239,11,220,7565,6540,911,52227,11,323,1477,458,10507,27278,2219,58,3479,17769,9533,2428,1110,89,1704,524,22048,370,15918,905,4846,34705,692,58,11377,468,33640,9533,2428,1110,89,1704,524,22048,370,15918,905,6710,13769,77,3508,692,20703,12730,220,12426,9533,2428,1110,89,1704,524,22048,370,15918,905,28547,69411,15228,692,145187,271,4703,10911,306,73335,198,56870,62901,11,9866,11,2738,819,11,323,70559,311,1492,498,3581,3220,323,5648,80975,382,145748,271,44505,11954,279,80651,198,56870,92735,11,37627,11,73356,11,9959,11,323,220,3516,311,4669,264,10655,18645,2272,382,145844,271,6025,279,80651,198,56870,48941,552,11,6512,2276,11,323,11560,11449,11,6707,835,697,25064,382,123908,108,271,71252,13474,20951,198,70674,18910,58221,11,23572,11,323,25197,10512,19171,27193,369,7565,25239,3880,382,148236,30543,198,8707,271,67740,388,6,6164,20678,13757,198,885,271,8420,525,1045,2256,19083,35298,429,646,387,1483,311,4347,8350,18024,476,4669,31062,382,58,2612,1588,9533,2428,1110,89,1704,524,22048,370,15918,905,6663,398,71,8,311,13186,2219,91,760,9248,91,4421,91,4421,7360,91,508,20703,2279,7,2428,1110,89,1704,524,22048,370,15918,905,14,9330,71,1963,88437,3508,7252,7,2428,1110,89,1704,524,22048,370,15918,905,6663,398,71,8,760,508,123908,100,2126,67067,311,7405,4615,9414,8436,3191,9533,2428,1110,89,1704,524,22048,370,15918,905,6663,398,71,26432,1323,1784,1323,29,26746,9691,35298,11,5821,11,220,32505,11,7218,3516,11,23189,11,14173,11,11919,13,760,151645,151648,198,71486,11,1077,752,1430,311,7071,700,1246,311,5486,419,3239,13,576,1196,3897,264,2504,315,1467,323,4588,369,264,4718,1633,448,3151,5043,3118,389,429,2213,13,2379,1083,9733,1667,5085,24980,10659,323,10282,1817,3772,2878,3668,13388,382,5338,11,358,1184,311,1349,1526,279,2661,6364,2213,15516,13,1084,594,911,264,8474,2190,369,52227,304,279,3283,13,576,1887,14158,2924,13997,3220,11,5382,2337,279,25064,11,1283,279,25064,11,25239,5392,89417,11,323,8016,261,86226,448,35298,382,40,3278,1191,553,59408,279,2265,13,576,1429,2989,949,374,330,41010,311,28778,2249,304,279,4311,553,29737,287,1335,714,432,594,264,2699,1293,13,10696,73381,432,311,4946,1212,220,21,15,5766,25,330,41010,311,28778,2249,304,279,4311,553,29737,287,2217,5847,11,279,4008,3880,311,387,63594,323,1795,5085,24980,17501,13,1084,1265,2924,1887,20844,1075,330,7976,287,10414,1335,330,83057,3220,1335,4992,2572,323,387,5810,2041,17194,476,1555,18303,13,358,3278,1281,2704,432,594,2163,220,16,21,15,5766,382,2461,20844,11,358,3278,1140,705,311,220,17,15,9760,3793,13,5542,279,1467,11,2989,6174,2578,2924,13347,1075,8039,9115,11,7218,3516,11,9072,3015,18610,11,323,773,389,382,20970,1265,387,26829,95671,13,576,8474,14521,5257,13566,315,52227,11,773,7196,330,39,21738,1335,330,12730,9414,1335,323,330,32687,6572,1,4946,1632,382,15930,525,3151,20844,429,1492,448,2711,2897,13,358,3278,3293,220,18,12,23,9492,5435,311,279,2213,11,1075,330,7976,287,10414,1335,330,8926,2272,1335,4992,382,40,1184,311,5978,678,5043,3367,862,19511,3084,16982,25,2265,1212,220,21,15,5766,11,4008,1212,220,16,21,15,13,55695,705,311,220,17,15,4244,11,11059,323,9492,1817,2878,13276,5109,382,23949,11,358,3278,5944,4297,1119,264,4718,1633,2041,894,5107,1467,476,40841,11,1101,279,4718,438,11223,624,151649,271,73594,2236,198,515,220,330,2102,788,330,41010,311,28778,2249,304,279,4311,553,29737,287,756,220,330,4684,788,330,37438,2283,6540,369,71545,39916,389,8039,287,11,3728,11,1651,819,11,323,17080,13,14934,1246,311,1477,458,10507,27278,1393,13997,3220,323,30426,4185,20643,10346,220,330,28995,788,2278,262,330,7976,287,10414,756,262,330,83057,3220,756,262,330,8926,2272,756,262,330,1960,6572,9462,756,262,330,48406,9115,756,262,330,65115,3516,756,262,330,63365,3015,18610,756,262,330,1937,58221,756,262,330,20257,3395,756,262,330,43919,5392,89417,756,262,330,5117,13404,756,262,330,65115,10414,756,262,330,265,2527,8474,756,262,330,416,11234,72557,756,262,330,46764,3188,756,262,330,2438,3516,756,262,330,7976,261,31062,756,262,330,22249,2737,756,262,330,3397,17975,698,220,3211,220,330,15497,788,4383,39,21738,497,330,12730,9414,497,330,32687,6572,8097,220,330,14082,788,4383,7976,287,10414,497,330,8926,2272,497,330,1960,6572,9462,497,330,48406,9115,497,330,65115,3516,7026,532,73594],"total_duration":204654135200,"load_duration":5237710500,"prompt_eval_count":463,"prompt_eval_duration":16993468700,"eval_count":596,"eval_duration":181269945700}"""
    res = parse_ollama_response(RAW)
    print(json.dumps(res, ensure_ascii=False, indent=2))
